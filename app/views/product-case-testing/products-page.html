{% extends "layout-user-testing.html" %}

{% block pageTitle %}
    Products
{% endblock %}



{% block content %}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds"> <!-- govuk-grid-column-three-quarters govuk-!-margin-bottom-7 -->
        <h1 class="govuk-heading-l govuk-!-margin-bottom-2">
            Products
        </h1>

        <!--div class="govuk-hint">
            <span id="search-hint"></span>
        </div-->

        <details class="govuk-details opss-details--sm" data-module="govuk-details">
            <summary class="govuk-details__summary">
                <span class="govuk-details__summary-text">
                    Help with the products page
                </span>
            </summary>
            <div class="govuk-details__text">
                <p class="govuk-body-s">
                    <span id="search-hint">You can search for products using keywords from the name and model or by using a barcode. A barcode is normally 13 digits, although older products may have a 12 digit number.</span>
                </p>
                <p class="govuk-body-s">
                    You can also create a case for a product or add a product if it doesn't already exist<!-- within our records-->.
                </p>
            </div>
        </details>
    </div>
    <div class="govuk-grid-column-one-third govuk-!-margin-top-8">
        <a href="/product-case-testing/do-you-have-the-barcode" class="govuk-link govuk-link--no-visited-state govuk-!-font-size-19 opss-text-align-right opss-text-underline-offset">
            Add a product
        </a>
    </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">

        <form id="searchForm" action="#" method="post" novalidate>
            <div class="govuk-form-group govuk-!-padding-top-4 govuk-!-padding-bottom-2" data-test-for="input" data-test-ele-name="products-search">

                <label class="govuk-label" for="products-search">
                    Search for a product
                </label>

                <div class="govuk-input__wrapper opss-search__wrapper">
                    <input class="govuk-input govuk-!-width-one-half" type="search" id="products-search" name="products-search" aria-describedby="search-hint">
                    <button class="govuk-button govuk-!-margin-bottom-0" data-module="govuk-button">
                        <span class="govuk-visually-hidden">Search</span>
                    </button>
                </div>

                <fieldset class="govuk-fieldset">
                    <legend class="govuk-visually-hidden">
                        Is your search using keywords or a barcode?
                    </legend>
                    <div class="govuk-radios govuk-radios--inline govuk-radios--small">
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="keywords" name="searchtype" type="radio" value="keywords" checked="checked">
                            <label class="govuk-label govuk-radios__label govuk-!-font-size-16" for="keywords">
                                Using keywords
                            </label>
                        </div>
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="barcode" name="searchtype" type="radio" value="barcode">
                            <label class="govuk-label govuk-radios__label govuk-!-font-size-16" for="barcode">
                                Using a barcode
                            </label>
                        </div>
                    </div>
                </fieldset>

            </div>
        </form>

    </div>
</div>

<div class="govuk-grid-row">

    <section class="govuk-grid-column-one-quarter">

        <form action="#" method="post" style="visibility: hidden;" novalidate>

            <h2 class="govuk-heading-m">
                Filter options<span class="govuk-visually-hidden">:</span>
            </h2>

            <div class="govuk-form-group">
                <fieldset class="govuk-fieldset">
                    <legend class="govuk-fieldset__legend">
                        Products
                    </legend>
                    <div class="govuk-radios govuk-radios--small">
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="linked-to-case" name="linked-to-case" type="radio" value="all" checked="checked">
                            <label class="govuk-label govuk-radios__label" for="linked-to-case">
                                All
                            </label>
                        </div>
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="linked-to-case-2" name="linked-to-case" type="radio" value="with">
                            <label class="govuk-label govuk-radios__label" for="linked-to-case-2">
                                With cases
                            </label>
                        </div>
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="linked-to-case-3" name="linked-to-case" type="radio" value="without">
                            <label class="govuk-label govuk-radios__label" for="linked-to-case-3">
                                Without cases
                            </label>
                        </div>
                    </div>
                </fieldset>
            </div>

            <div class="govuk-form-group">
                <fieldset class="govuk-fieldset">
                    <legend class="govuk-fieldset__legend">
                        Linked to a case
                    </legend>
                    <div class="govuk-checkboxes govuk-checkboxes--small">
                        <div class="govuk-checkboxes__item">
                            <input class="govuk-checkboxes__input" id="linked-to-product" name="linked-to-product" type="checkbox" value="yes" checked="checked">
                            <label class="govuk-label govuk-checkboxes__label" for="linked-to-product">
                                Yes
                            </label>
                        </div>
                        <div class="govuk-checkboxes__item">
                            <input class="govuk-checkboxes__input" id="linked-to-product-2" name="linked-to-product" type="checkbox" value="no" checked="checked">
                            <label class="govuk-label govuk-checkboxes__label" for="linked-to-product-2">
                                No
                            </label>
                        </div>
                    </div>
                </fieldset>
            </div>

            <div class="govuk-form-group">
                <fieldset class="govuk-fieldset">
                    <legend class="govuk-fieldset__legend">
                        Added by
                    </legend>
                    <div class="govuk-radios govuk-radios--small">
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="added-by" name="added-by" type="radio" value="any" checked="checked">
                            <label class="govuk-label govuk-radios__label" for="added-by">
                                Anyone
                            </label>
                        </div>
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="added-by-2" name="added-by" type="radio" value="me">
                            <label class="govuk-label govuk-radios__label" for="added-by-2">
                                Me
                            </label>
                        </div>
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="added-by-3" name="added-by" type="radio" value="team">
                            <label class="govuk-label govuk-radios__label" for="added-by-3">
                                My team
                            </label>
                        </div>
                    </div>
                </fieldset>
            </div>

            <div class="govuk-form-group">
                <fieldset class="govuk-fieldset">
                    <legend class="govuk-fieldset__legend">
                        Added
                    </legend>
                    <div class="govuk-radios govuk-radios--small">
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="added-when" name="added-when" type="radio" value="anytime" checked="checked">
                            <label class="govuk-label govuk-radios__label" for="added-when">
                                Anytime
                            </label>
                        </div>
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="added-when-2" name="added-when" type="radio" value="3mths">
                            <label class="govuk-label govuk-radios__label" for="added-when-2">
                                Within 3 months
                            </label>
                        </div>
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="added-when-3" name="added-when" type="radio" value="6mths">
                            <label class="govuk-label govuk-radios__label" for="added-when-3">
                                Within 6 months
                            </label>
                        </div>
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="added-when-4" name="added-when" type="radio" value="12mths">
                            <label class="govuk-label govuk-radios__label" for="added-when-4">
                                Within 12 months
                            </label>
                        </div>
                    </div>
                </fieldset>
            </div>

            <div class="govuk-button-group">
                <button type="submit" class="govuk-button" data-module="govuk-button">
                    Apply
                </button>

                <button type="reset" class="govuk-button opss-button-link opss-nojs-hide govuk-!-font-size-16" id="opss-reset" data-module="govuk-button">
                    Reset form
                </button>
            </div>

        </form>


        <!--form action="#" method="post" novalidate>
            <div class="govuk-form-group">
                <fieldset class="govuk-fieldset">

                    <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
                        <h2 class="govuk-fieldset__heading">
                            Filter options<span class="govuk-visually-hidden">:</span>
                        </h2>
                    </legend>

                    <div class="govuk-form-group">
                        <label class="govuk-label" for="category">
                            Product category
                        </label>
                        <select class="govuk-select" id="category" name="category">
                            <option value="">All</option>
                            <option value="val01">Option 1</option>
                            <option value="val02">Option 2</option>
                            <option value="val03" selected>Option 3</option>
                            <option value="val04">Option 4</option>
                        </select>
                    </div>

                    <div class="govuk-radios govuk-radios--small govuk-radios--conditional" data-module="govuk-radios">

                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="by-date" name="dates" type="radio" value="by-date" data-aria-controls="conditional-date-block-1" aria-describedby="by-date-hint">
                            <label class="govuk-label govuk-radios__label" for="by-date">
                                Date
                            </label>
                        </div>
                        <div class="govuk-radios__conditional govuk-radios__conditional--hidden" id="conditional-date-block-1">
                            <div class="govuk-form-group">

                                <div id="by-date-hint" class="govuk-hint govuk-!-font-size-16">
                                    The date notified. <br>
                                    For example, 14 08 2019.
                                </div>

                                <div class="govuk-date-input" id="by-date">
                                <div class="govuk-date-input__item">
                                    <div class="govuk-form-group">
                                    <label class="govuk-label govuk-date-input__label" for="by-date-day">
                                        Day
                                    </label>
                                    <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="by-date-day" name="by-date-day" type="text" pattern="[0-9]*" inputmode="numeric">
                                    </div>
                                </div>
                                <div class="govuk-date-input__item">
                                    <div class="govuk-form-group">
                                    <label class="govuk-label govuk-date-input__label" for="by-date-month">
                                        Month
                                    </label>
                                    <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="by-date-month" name="by-date-month" type="text" pattern="[0-9]*" inputmode="numeric">
                                    </div>
                                </div>
                                <div class="govuk-date-input__item">
                                    <div class="govuk-form-group">
                                    <label class="govuk-label govuk-date-input__label" for="by-date-year">
                                        Year
                                    </label>
                                    <input class="govuk-input govuk-date-input__input govuk-input--width-4" id="by-date-year" name="by-date-year" type="text" pattern="[0-9]*" inputmode="numeric">
                                    </div>
                                </div>
                                </div>

                            </div>
                        </div>
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="by-date-range" name="dates" type="radio" value="by-date-range" data-aria-controls="conditional-date-block-2" aria-describedby="by-date-range-hint">
                            <label class="govuk-label govuk-radios__label" for="by-date-range">
                                Date range
                            </label>
                        </div>

                        <div class="govuk-radios__conditional govuk-radios__conditional--hidden" id="conditional-date-block-2">
                            <div class="govuk-form-group">

                                <div id="by-date-range-hint" class="govuk-hint govuk-!-font-size-16">
                                    The dates notified within a date range. For example, from <span class="opss-no-wrap">01 04 2019</span> to <span class="opss-no-wrap">30 09 2020</span>.
                                </div>
                                <div class="govuk-hint govuk-!-font-size-16">
                                    From<span class="govuk-visually-hidden">:</span>
                                </div>

                                <div class="govuk-date-input" id="by-date-from">
                                <div class="govuk-date-input__item">
                                    <div class="govuk-form-group">
                                    <label class="govuk-label govuk-date-input__label" for="by-date-from-day">
                                        Day
                                    </label>
                                    <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="by-date-from-day" name="by-date-from-day" type="text" pattern="[0-9]*" inputmode="numeric"></div>
                                </div>
                                <div class="govuk-date-input__item">
                                    <div class="govuk-form-group">
                                    <label class="govuk-label govuk-date-input__label" for="by-date-from-month">
                                        Month
                                    </label>
                                    <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="by-date-from-month" name="by-date-from-month" type="text" pattern="[0-9]*" inputmode="numeric"></div>
                                </div>
                                <div class="govuk-date-input__item">
                                    <div class="govuk-form-group">
                                    <label class="govuk-label govuk-date-input__label" for="by-date-from-year">
                                        Year
                                    </label>
                                    <input class="govuk-input govuk-date-input__input govuk-input--width-4" id="by-date-from-year" name="by-date-from-year" type="text" pattern="[0-9]*" inputmode="numeric"></div>
                                </div>
                                </div>

                                <div class="govuk-hint govuk-!-font-size-16 govuk-!-margin-top-4 govuk-!-margin-bottom-3">
                                    To<span class="govuk-visually-hidden">:</span>
                                </div>

                                <div class="govuk-date-input" id="by-date-to">
                                <div class="govuk-date-input__item">
                                    <div class="govuk-form-group">
                                    <label class="govuk-label govuk-date-input__label" for="by-date-to-day">
                                        Day
                                    </label>
                                    <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="by-date-to-day" name="by-date-to-day" type="text" pattern="[0-9]*" inputmode="numeric">
                                    </div>
                                </div>
                                <div class="govuk-date-input__item">
                                    <div class="govuk-form-group">
                                    <label class="govuk-label govuk-date-input__label" for="by-date-to-month">
                                        Month
                                    </label>
                                    <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="by-date-to-month" name="by-date-to-month" type="text" pattern="[0-9]*" inputmode="numeric">
                                    </div>
                                </div>
                                <div class="govuk-date-input__item">
                                    <div class="govuk-form-group">
                                    <label class="govuk-label govuk-date-input__label" for="by-date-to-year">
                                        Year
                                    </label>
                                    <input class="govuk-input govuk-date-input__input govuk-input--width-4" id="by-date-to-year" name="by-date-to-year" type="text" pattern="[0-9]*" inputmode="numeric">
                                    </div>
                                </div>
                                </div>

                            </div>
                        </div>

                    </div>

                </fieldset>
            </div>

            <div class="govuk-button-group">
                <button type="submit" class="govuk-button" data-module="govuk-button">
                    Apply
                </button>

                <button type="reset" class="govuk-button opss-button-link opss-nojs-hide" id="opss-reset" data-module="govuk-button">
                    Reset form
                </button>
            </div>

        </form-->
    </section>

    <section class="govuk-grid-column-three-quarters">
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-full" role="region" aria-label="Product lists">

                <table id="table-items" class="govuk-table opss-table-items">
                    <caption class="govuk-visually-hidden">
                        Products data: The table features three columns and each product is described across corresponding rows within each table body.
                    </caption>
                    <thead class="govuk-table__head">
                        <tr class="govuk-table__row">
                            <th class="govuk-visually-hidden">&nbsp;</th>
                            <th id="psd-ref" scope="col" class="govuk-table__header"><abbr>PSD</abbr> ref</th>
                            <th id="caseowner" scope="col" class="govuk-table__header">Product type</th>
                            <th id="updated" scope="col" class="govuk-table__header">Category</th>
                        </tr>
                    </thead>

                    <tfoot class="govuk-table__head">
                        <tr class="govuk-table__row">
                            <th class="govuk-visually-hidden">&nbsp;</th>
                            <th scope="col" class="govuk-table__header"><abbr>PSD</abbr> ref</th>
                            <th scope="col" class="govuk-table__header">Product type</th>
                            <th scope="col" class="govuk-table__header">Category</th>
                        </tr>
                    </tfoot>

                </table>

                <!--nav class="opss-pagination-link opss-pagination-link--no-top-border">
                    <ul>
                        <li class="opss-pagination-link__wrap opss-pagination-link--text govuk-body">
                            Page 1
                        </li>
                        <li class="opss-pagination-link__wrap opss-pagination-link--next">
                            <a href="select-a-product-pg2.html" class="govuk-link govuk-link--no-visited-state">
                                <span>Next</span><span class="govuk-visually-hidden">:</span> <span>Page 2 of 3</span>
                            </a>
                        </li>
                    </ul>
                </nav-->


            </div>
        </div>
    </section>

</div>

<!--script>
    var tbody = document.getElementById("table-items").querySelectorAll(".govuk-table__body");

    tbody.forEach(function(tobj) {
        tobj.addEventListener("mouseover", function() {
            tobj.classList.add('opss-bg');
        });
        tobj.addEventListener("mouseout", function() {
            tobj.classList.remove('opss-bg');
        });
    });
</script-->


{% endblock %}

{% block bodyEnd %}

  {% block scripts %}
    {% include "includes/scripts-testing.html" %}
    {% block pageScripts %}
    {% endblock %}
  {% endblock %}






<script>
function buildHTML(val, o, c){
    o += '<tr class="govuk-table__row">';
    o += '<th class="govuk-visually-hidden">Product</th>';
    o += '<th id="item-'+val.id+'" colspan="3" scope="colgroup" class="govuk-table__header"><a href="#" class="govuk-link govuk-link--no-visited-state">'+ val.product_name +'</a></th>';
    o += '</tr><tr class="govuk-table__row">';
    o += '<th headers="item-'+val.id+'" id="meta-'+val.id+'" class="govuk-visually-hidden">Metadata</th>';
    o += '<td headers="psd-ref item-'+val.id+' meta-'+val.id+'" class="govuk-table__cell">psd-'+val.id+'</td>';
    o += '<td headers="caseowner item-'+val.id+' meta-'+val.id+'" class="govuk-table__cell">'+ val.product_type +'</td>';
    o += '<td headers="updated item-'+val.id+' meta-'+val.id+'" class="govuk-table__cell">'+ val.product_category +'</td>';
    o += '</tr><tr class="govuk-table__row">';
    o += '<th headers="item-'+val.id+'" id="actions-'+val.id+'" class="govuk-visually-hidden">Actions</th>';
    o += '<td headers="item-'+val.id+' actions-'+val.id+'" colspan="3" class="govuk-table__cell"><a href="/product-case-testing/is-this-case-related-to-covid" class="govuk-link govuk-link--no-visited-state">Create a case <span class="govuk-visually-hidden"> for psd-'+val.id+'</span></a></td>';
    o += '</tr>';
    if(c%2 == 0){
    o += '</tbody><tbody class="govuk-table__body">'
    }else{
        o += '</tbody>';
    }

    return o;
}



  jQuery(document).ready(function(){

    setMenuState('products');
    localStorage.removeItem('addCaseToProduct');
    $('#products-search').val('');// autocomplete="off"


    var data = [
    {"id":"503","product_name":"Sony 3000 hair dryer (x3000rpm)","product_type":"Hair dryer","product_category":"Electrical goods","product_image":"image_1.png"},
    {"id":"466","product_name":"Dyson Animal 2","product_type":"Vaccum cleaner","product_category":"63","product_image":"image_2.png"},
    {"id":"108","product_name":"Ashton Cox","product_type":"86000","product_category":"66","product_image":"image_3.png"},
    {"id":"660","product_name":"Cedric Kelly","product_type":"433060","product_category":"22","product_image":"image_4.png"},
    {"id":"278","product_name":"Airi Satou","product_type":"162700","product_category":"33","product_image":"image_5.png"},
    {"id":"396","product_name":"Brielle Williamson","product_type":"372000","product_category":"61","product_image":"image_6.png"},
    {"id":"119","product_name":"Herrod Chandler","product_type":"137500","product_category":"59","product_image":"image_7.png"},
    {"id":"448","product_name":"Rhona Davidson","product_type":"327900","product_category":"55","product_image":"image_8.png"},
    {"id":"402","product_name":"Colleen Hurst","product_type":"205500","product_category":"39","product_image":"image_9.png"},
    {"id":"459","product_name":"Sonya Frost","product_type":"103600","product_category":"23","product_image":"image_10.png"}
    ];//var data = $.getJSON( '/public/javascripts/products.js');

        function getResults(searchField){

            var tableItems = $('#table-items');
            tableItems.find('tbody').remove();

            var regex = new RegExp(searchField, "i");
            var output = '<tbody class="govuk-table__body">';
            var count = 1;

			if(searchField === ''){//show all products

                $.each(data, function(key, val) {
                    output =  buildHTML(val, output, count);
                    count++;
                });

			} else {//search input has a value

                $.each(data, function(key, val){
                    if ((val.product_type.search(regex) != -1) || (val.product_name.search(regex) != -1)) {
                        output =  buildHTML(val, output, count);
                        count++;
                    }
                });

                if(count <= 1){
                    //tableItems.addClass('hidden');
                    output = '<tbody class="govuk-table__body"><tr class="govuk-table__row"><td class="govuk-visually-hidden"></td><td class="govuk-table__cell opss-temp-td" colspan="3">There are no products matching your search.</td></tr></tbody>';
                    count++;
                }
            }

            $(output).insertAfter(tableItems.find('thead'));//INSERT IN PAGE

            tableItems.find('td .govuk-link').on('click', function(e){
                e.preventDefault();
                localStorage.setItem('addCaseToProduct', 'yes');
                window.location.assign($(this).attr('href'));
            });
        }

        $('#searchForm').find('button').click(function(e) {
            e.preventDefault();
            var txt = $('#products-search').val();
            getResults(txt);
        });

        getResults();//onload

});
</script>

{% endblock %}
